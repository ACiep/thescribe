!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Thescribe=e():t.Thescribe=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Application:()=>o,defineComponent:()=>p});const s={childList:!0,subtree:!0};class o{constructor(t){this.$root=t,this.components={},this.observer=new MutationObserver((t=>{for(const e of t)for(const t of e.addedNodes){const e=t.dataset?.component;if(e){const s=this.components[e];s&&s(t)}}})),this.observer.observe(this.$root,s)}registerComponent(t,e){this.components[t]=e;const s=`[data-component=${t}]`,o=this.$root.querySelectorAll(s);for(const t of o)e(t)}}function r(t,e){return null===t?e:`${t}.${e}`}class n{proxyHandler={get:(t,e)=>{const s=t.values[e],o=r(t.parent,e);return"object"==typeof s&&null!==s?this.makeProxiedState(s,o):(this.observedValues.add(o),s)}};constructor(t,e,s,o){this.$self=t,this.$node=e,this.observedValues=new Set,this.state=this.makeProxiedState(s),this.handler=o.bind(this),this.run()}makeProxiedState(t,e=null){return new Proxy({values:t,parent:e},this.proxyHandler)}notify(t){this.observedValues.has(t)&&this.run()}run(){this.observedValues.clear(),this.applyEffect()}}class i extends n{constructor(t,e,s,o){super(t,e,s,o)}applyEffect(){const t=this.handler(this.state,this.$self);for(let[e,s]of Object.entries(t))if(null==s||!1===s)this.$node.removeAttribute(e);else if("object"==typeof s)for(const[t,o]of Object.entries(s))this.$node[e][t]=o;else this.$node.setAttribute(e,s)}}class a extends n{constructor(t,e,s,o){super(t,e,s,o)}applyEffect(){const t=this.handler(this.state,this.$self);for(let[e,s]of Object.entries(t))s?this.$node.classList.add(e):this.$node.classList.remove(e)}}class c extends n{constructor(t,e,s,o){super(t,e,s,o)}applyEffect(){!function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.$node);const t=this.handler(this.state,this.$self);null!=t&&this.$node.appendChild(document.createTextNode(t))}}function l(t,e,s,o,r){switch(t){case"text":return new c(e,s,o,r);case"attribute":return new i(e,s,o,r);case"classes":return new a(e,s,o,r);default:throw new Error}}class h{constructor(t,e,s,o){this.$self=t,this.$node=e,this.state=s,this.connect(o)}connect(t){for(const[e,s]of Object.entries(t))this.$node.addEventListener(e,(t=>{s(t,this.state,this.$self)}))}}class f{constructor(){this.mutatedValues=new Set,this.effects=[]}addEffect(t){this.effects.push(t)}mutate(t){this.mutatedValues.add(t),this.notify()}notify(){for(const t of this.mutatedValues)for(const e of this.effects)e.notify(t);this.mutatedValues.clear()}}class u{handler={get:(t,e)=>{const s=t.values[e],o=r(t.parent,e);return"object"==typeof s&&null!==s?this.makeProxiedState(s,o):s},set:(t,e,s)=>{const o=r(t.parent,e);return t.values[e]=s,this.mutationTracker.mutate(o),!0}};constructor(t,e){this.mutationTracker=e,this.state=this.makeProxiedState(t)}makeProxiedState(t,e=null){return new Proxy({values:t,parent:e},this.handler)}}class d{constructor(t,e,s){this.$self=t,this.$node=e,this.effect=s}}function p(t){return e=>new b(e,t)}class b{constructor(t,e){this.$self=t,this.mutationTracker=new f;const s="function"==typeof e.state?e.state(t):{...e.state};this.mutableState=new u(s,this.mutationTracker),this.targets=[],this.factors=[],this.init(e)}init(t){this.loadTargets(t),this.loadFactors(t)}loadTargets(t){for(const[e,s]of Object.entries(t.targets)){const t=`[data-target=${e}]`,o=this.$self.querySelector(t);for(const[t,e]of Object.entries(s)){const s=l(t,this.$self,o,this.mutableState.state,e);this.mutationTracker.addEffect(s);const r=new d(this.$self,o,s);this.targets.push(r)}}}loadFactors(t){for(const[e,s]of Object.entries(t.factors)){const t=`[data-factor=${e}]`,o=this.$self.querySelector(t),r=new h(this.$self,o,this.mutableState.state,s);this.factors.push(r)}}}return e})()}));